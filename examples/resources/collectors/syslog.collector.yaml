name: syslog

connector:
  name: tcp
  kind: listener
  url: :1514
  protocol: tcp

normalizer:
  name: syslog
  kind: syslog
  mapping:
    - sourceField: severity
      eventField: OriginSeverity
    - sourceField: time
      eventField: OriginTimestamp
    - sourceField: host
      eventField: OriginDNSName
    - sourceField: app
      eventField: OriginProcessName
    - sourceField: msg
      eventField: Message
      extra:
        - triggerField: app
          triggerValue: rest
          normalizer:
            name: json
            kind: json
            mapping:
              - sourceField: version
                eventField: OriginServiceVersion
              - sourceField: request.proto
                eventField: RequestApplicationProtocol
              - sourceField: request.method
                eventField: RequestMethod
              - sourceField: request.url
                eventField: RequestURL
              - sourceField: request.status
                eventField: RequestStatus
              - sourceField: request.bytes
                eventField: RequestBytesIn
              - sourceField: session.user
                eventField: RequestUser

filters:
  - name: cron
    sections:
      - conditions:
          - field: OriginProcessName
            op: =
            constant: CRON

enrichment:
  - field: Severity
    valueSourceKind: dictionary
    valueSourceName: syslog-raccoon-severity
    keyFields:
      - OriginSeverity

rules:
  - name: rest-ok
    threshold: 100
    window: 10
    identicalFields:
      - RequestURL
      - RequestMethod
    sumField:
      - RequestBytesIn
    filter:
      name: rest-ok
      sections:
        - conditions:
            - field: RequestStatus
              op: =
              constant: "200"

destinations:
  #- name: console
  #  kind: console
  - name: correlators
    kind: nats
    url: nats://localhost:4222
    subject: raccoon-correlation
  - name: storage
    kind: elastic
    url: http://localhost:9200
    index: raccoon-events

dictionaries:
  - name: syslog-raccoon-severity
    data:
      0: 3
      1: 3
      2: 2
      3: 2
      4: 1
      5: 0
      6: 0
      7: 0
